@using Microsoft.AspNet.Identity
@using Microsoft.AspNet.Identity.Owin
@using NAppTracking.Server.Entities
@if (this.Request.IsAuthenticated)
{
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="@Url.Action("Index", "Application")">All</a></li>
            <li class="divider"></li>
            @foreach (var application in this.Context.GetOwinContext().GetUserManager<ApplicationUserManager>().FindById(this.User.Identity.GetUserId()).Applications)
            {
                <li><a href="@Url.Action("Details", "Application", new { application.Id })">@application.Name</a></li>        
            }
        </ul>
    </li>
}
else
{
    <li>@Html.ActionLink("Applications", "Index", "Application")</li>
}